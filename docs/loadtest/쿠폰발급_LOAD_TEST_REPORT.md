# k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ êµ¬ì¶• ë° ë¬¸ì œ í•´ê²° ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-12-22
**í”„ë¡œì íŠ¸**: E-commerce Core - ì¿ í° ë°œê¸‰ ì‹œìŠ¤í…œ
**ëª©ì **: ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ APIì˜ ë™ì‹œì„± ì œì–´ ë° ì„±ëŠ¥ ê²€ì¦

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì´ˆê¸° ë¬¸ì œ ìƒí™©](#ì´ˆê¸°-ë¬¸ì œ-ìƒí™©)
3. [ë¬¸ì œ í•´ê²° ê³¼ì •](#ë¬¸ì œ-í•´ê²°-ê³¼ì •)
4. [ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼](#ìµœì¢…-í…ŒìŠ¤íŠ¸-ê²°ê³¼)
5. [í•µì‹¬ ê°œì„  ì‚¬í•­](#í•µì‹¬-ê°œì„ -ì‚¬í•­)
6. [ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­](#ê²°ë¡ -ë°-ê¶Œì¥ì‚¬í•­)

---

## í”„ë¡œì íŠ¸ ê°œìš”

### í…ŒìŠ¤íŠ¸ ëŒ€ìƒ
- **API**: ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ (POST `/api/coupons/{couponId}/issue`)
- **ë™ì‹œì„± ì œì–´**: Redis ë¶„ì‚° ë½ + Kafka ë¹„ë™ê¸° ì²˜ë¦¬
- **ëª©í‘œ**: ì¤‘ë³µ ë°œê¸‰ ë°©ì§€ ë° ë†’ì€ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬

### í…ŒìŠ¤íŠ¸ í™˜ê²½
- **ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬**: k6 (Grafana Labs)
- **ë°ì´í„°ë² ì´ìŠ¤**: MySQL 8.0
- **ìºì‹œ/ë©”ì‹œì§€í**: Redis, Apache Kafka
- **í…ŒìŠ¤íŠ¸ ë°ì´í„°**: LoadTestDataSeeder (JdbcTemplate ê¸°ë°˜)

---

## ì´ˆê¸° ë¬¸ì œ ìƒí™©

### ë¬¸ì œ 1: ì—ëŸ¬ìœ¨ 76.57% ğŸ”´

**ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼:**
```
ì´ ìš”ì²­: 68,853ê±´
ì—ëŸ¬ìœ¨: 76.57%
í’ˆì ˆ ì—ëŸ¬: 49,318ê±´
ì¿ í° ì¬ê³ : 10,000ê°œ
```

**ì›ì¸ ë¶„ì„:**
- ì¿ í° ì¬ê³  10,000ê°œ ëŒ€ë¹„ ìš”ì²­ 68,853ê±´ (ì•½ 7ë°° ì´ˆê³¼)
- ì¬ê³  ì†Œì§„ í›„ ëŒ€ë¶€ë¶„ì˜ ìš”ì²­ì´ í’ˆì ˆ ì—ëŸ¬ ë°œìƒ

---

### ë¬¸ì œ 2: ì—ëŸ¬ìœ¨ 99.09% ğŸ”´

**ë‘ ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (VU ì¡°ì • í›„):**
```
ì´ ìš”ì²­: 59,416ê±´
ì—ëŸ¬ìœ¨: 99.09%
í’ˆì ˆ ì—ëŸ¬: 56,599ê±´
ì„±ê³µí•œ ì¿ í° ë°œê¸‰: 60ê±´ë§Œ
```

**ì›ì¸ ë¶„ì„:**
```javascript
// k6 ìŠ¤í¬ë¦½íŠ¸
function getRandomUserId() {
  const randomNum = Math.floor(Math.random() * 20000) + 1;  // âŒ 20,000ëª…
  return `test-user-${randomNum}`;
}
```

```java
// LoadTestDataSeeder.java
private static final int TEST_USER_COUNT = 100;  // âŒ 100ëª…ë§Œ ìƒì„±
```

**í•µì‹¬ ë¬¸ì œ:**
- **í…ŒìŠ¤íŠ¸ ìœ ì €**: 100ëª…ë§Œ ìƒì„±
- **k6 ìš”ì²­**: test-user-1 ~ test-user-20000 ë²”ìœ„ë¡œ ìš”ì²­
- **ê²°ê³¼**: ëŒ€ë¶€ë¶„ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìœ ì €ë¡œ ìš”ì²­ â†’ ì‹¤íŒ¨

---

### ë¬¸ì œ 3: ì—ëŸ¬ìœ¨ 99.96% ğŸ”´

**ì„¸ ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (ìœ ì € 10,000ëª…ìœ¼ë¡œ ì¦ê°€):**
```
ì´ ìš”ì²­: 62,252ê±´
ì—ëŸ¬ìœ¨: 99.96%
í’ˆì ˆ ì—ëŸ¬: 59,964ê±´
ì‹¤ì œ ë°œê¸‰: 10,000ê°œ (ì „ì²´ ì¬ê³ )
```

**ì›ì¸ ë¶„ì„:**
```sql
SELECT id, total_quantity, issued_quantity, remaining_quantity
FROM coupons WHERE id = 'test-coupon-1';

-- ê²°ê³¼
issued_quantity: 10,000
remaining_quantity: 90,000  -- âŒ ì¬ê³ ëŠ” ë‚¨ì•„ìˆìŒ
```

**í•µì‹¬ ë¬¸ì œ:**
- ìœ ì € 10,000ëª… Ã— ê° 1ë²ˆì”© ë°œê¸‰ = 10,000ê°œ ë°œê¸‰ ì™„ë£Œ
- ë‚˜ë¨¸ì§€ ~52,000ë²ˆì˜ ìš”ì²­ì€ **ë™ì¼ ìœ ì €ì˜ ì¤‘ë³µ ì‹œë„**
- ì¤‘ë³µ ë°œê¸‰ ë°©ì§€ ë¡œì§ì´ ì •ìƒ ì‘ë™í•˜ì—¬ í’ˆì ˆë¡œ ê°„ì£¼

---

### ë¬¸ì œ 4: k6 ì»¤ìŠ¤í…€ ìš”ì•½ ì¶œë ¥ ì‹¤íŒ¨ ğŸ”´

**ì—ëŸ¬ ë©”ì‹œì§€:**
```
TypeError: Cannot read property 'values' of undefined
at textSummary (coupon-issue-test.js:207:68)
```

**ì›ì¸:**
```javascript
// âŒ ì˜ëª»ëœ ì½”ë“œ
const duplicateErrors = data.metrics.duplicate_errors.values.count;
const soldOutErrors = data.metrics.sold_out_errors.values.count;
```

- `duplicate_errors`, `sold_out_errors`ëŠ” **Counter ë©”íŠ¸ë¦­**
- CounterëŠ” `values` ê°ì²´ê°€ ì—†ê±°ë‚˜ êµ¬ì¡°ê°€ ë‹¤ë¦„
- ì•ˆì „í•˜ì§€ ì•Šì€ ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ undefined ì—ëŸ¬ ë°œìƒ

---

## ë¬¸ì œ í•´ê²° ê³¼ì •

### í•´ê²° 1: í…ŒìŠ¤íŠ¸ ë°ì´í„° ê·œëª¨ ì¡°ì •

#### LoadTestDataSeeder.java ìˆ˜ì •
```java
// Before
private static final int TEST_USER_COUNT = 100;
private static final int TEST_COUPON_QUANTITY = 10000;

// After
private static final int TEST_USER_COUNT = 100000;  // 100ëª… â†’ 100,000ëª…
private static final int TEST_COUPON_QUANTITY = 100000;  // 10,000ê°œ â†’ 100,000ê°œ
```

**íš¨ê³¼:**
- ìœ ì € í’€ ëŒ€í­ í™•ëŒ€ â†’ ì¤‘ë³µ ì‹œë„ í™•ë¥  ê°ì†Œ
- ì¿ í° ì¬ê³  ì¦ê°€ â†’ ì¶©ë¶„í•œ ë°œê¸‰ ê°€ëŠ¥

---

### í•´ê²° 2: k6 ìŠ¤í¬ë¦½íŠ¸ ìœ ì € ë²”ìœ„ ë™ê¸°í™”

#### coupon-issue-test.js ìˆ˜ì •
```javascript
// Before
function getRandomUserId() {
  const randomNum = Math.floor(Math.random() * 20000) + 1;  // âŒ
  return `test-user-${randomNum}`;
}

// After
function getRandomUserId() {
  const randomNum = Math.floor(Math.random() * 100000) + 1;  // âœ…
  return `test-user-${randomNum}`;
}
```

**íš¨ê³¼:**
- k6 ìš”ì²­ ë²”ìœ„ì™€ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ìœ ì € ë²”ìœ„ ì¼ì¹˜
- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìœ ì €ë¡œ ì¸í•œ ë¶ˆí•„ìš”í•œ ì—ëŸ¬ ì œê±°

---

### í•´ê²° 3: k6 VU(Virtual Users) ìµœì í™”

#### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì¡°ì •
```javascript
export const options = {
  scenarios: {
    load_test: {
      executor: 'ramping-vus',
      stages: [
        { duration: '30s', target: 50 },   // 500 â†’ 50
        { duration: '1m', target: 50 },
        { duration: '30s', target: 0 },
      ],
    },
    peak_test: {
      executor: 'ramping-vus',
      stages: [
        { duration: '10s', target: 200 },  // 500 â†’ 200
        { duration: '30s', target: 200 },
        { duration: '10s', target: 0 },
      ],
    },
  },
  thresholds: {
    http_req_duration: ['p(95)<1000', 'p(99)<2000'],
    http_req_failed: ['rate<0.1'],
    errors: ['rate<0.05'],
  },
};
```

**íš¨ê³¼:**
- ì´ ìš”ì²­ ìˆ˜ ê°ì†Œ (68,853ê±´ â†’ 53,532ê±´)
- ì‹œìŠ¤í…œì— ê³¼ë¶€í•˜ ì—†ì´ ì‹¤ì§ˆì ì¸ ì„±ëŠ¥ ì¸¡ì • ê°€ëŠ¥

---

### í•´ê²° 4: ì•ˆì „í•œ ë©”íŠ¸ë¦­ ì ‘ê·¼

#### textSummary í•¨ìˆ˜ ìˆ˜ì •
```javascript
// Before (âŒ ë¶ˆì•ˆì „)
function textSummary(data, options) {
  return `
    ì¤‘ë³µ ë°œê¸‰ ì—ëŸ¬: ${data.metrics.duplicate_errors.values.count}
    í’ˆì ˆ ì—ëŸ¬: ${data.metrics.sold_out_errors.values.count}
  `;
}

// After (âœ… ì•ˆì „)
function textSummary(data, options) {
  // ì˜µì…”ë„ ì²´ì´ë‹ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì ‘ê·¼
  const httpReqs = data.metrics.http_reqs?.values?.count || 0;
  const tps = data.metrics.http_reqs?.values?.rate || 0;
  const avgDuration = data.metrics.http_req_duration?.values?.avg || 0;
  const errorRate = (data.metrics.errors?.values?.rate || 0) * 100;
  const duplicateErrors = data.metrics.duplicate_errors?.values?.count || 0;
  const soldOutErrors = data.metrics.sold_out_errors?.values?.count || 0;

  return `
=== ì¿ í° ë°œê¸‰ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===

ì´ ìš”ì²­ ìˆ˜: ${httpReqs}
í‰ê·  TPS: ${tps.toFixed(2)}

ì‘ë‹µ ì‹œê°„:
  - í‰ê· : ${avgDuration.toFixed(2)}ms
  - p(95): ${p95.toFixed(2)}ms
  - p(99): ${p99.toFixed(2)}ms

ì—ëŸ¬ í†µê³„:
  - ì „ì²´ ì—ëŸ¬ìœ¨: ${errorRate.toFixed(2)}%
  - ì¤‘ë³µ ë°œê¸‰ ì—ëŸ¬: ${duplicateErrors}
  - í’ˆì ˆ ì—ëŸ¬: ${soldOutErrors}
=====================================
  `;
}
```

**íš¨ê³¼:**
- TypeError ì™„ì „ í•´ê²°
- ì»¤ìŠ¤í…€ ìš”ì•½ì´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥
- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê°€ë…ì„± í–¥ìƒ

---

### í•´ê²° 5: ë°ì´í„° ìš”ì•½ ë©”ì‹œì§€ ë™ì í™”

#### printTestDataSummary() ìˆ˜ì •
```java
// Before (í•˜ë“œì½”ë”©)
System.out.println("âœ… ìœ ì €: test-user-1 ~ test-user-100 (ê° ì”ì•¡ 1,000,000ì›)");

// After (ë™ì )
System.out.println("âœ… ìœ ì €: test-user-1 ~ test-user-" + TEST_USER_COUNT + " (ê° ì”ì•¡ 1,000,000ì›)");
System.out.println("âœ… ì¥ë°”êµ¬ë‹ˆ: test-cart-1 ~ test-cart-" + TEST_USER_COUNT);
System.out.println("   - ì‚¬ìš©ì: test-user-1 ~ test-user-" + TEST_USER_COUNT);
```

**íš¨ê³¼:**
- ìƒìˆ˜ê°’ ë³€ê²½ ì‹œ ìš”ì•½ ë©”ì‹œì§€ ìë™ ì—…ë°ì´íŠ¸
- ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

---

## ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼

### âœ… ìµœì¢… ê²€ì¦ ì™„ë£Œ (2025-12-23)

#### í…ŒìŠ¤íŠ¸ í™˜ê²½
```
- í…ŒìŠ¤íŠ¸ ìœ ì €: 100,000ëª…
- ì¿ í° ì¬ê³ : 100,000ê°œ
- í…ŒìŠ¤íŠ¸ ê¸°ê°„: 2ë¶„ 50ì´ˆ
- ì‹œë‚˜ë¦¬ì˜¤: Load Test (50 VU) + Peak Test (200 VU)
- ìœ ì € ì„ íƒ ë°©ì‹: Random (ì‹¤ì œ ìš´ì˜ í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜)
```

#### í•µì‹¬ ì§€í‘œ (ìµœì¢…)

| ë©”íŠ¸ë¦­ | ê²°ê³¼ | ëª©í‘œ | ìƒíƒœ |
|--------|------|------|------|
| **ì´ ìš”ì²­ ìˆ˜** | 63,331ê±´ | - | - |
| **í‰ê·  TPS** | 372.32 req/s | 200+ | âœ… ìš°ìˆ˜ |
| **í‰ê·  ì‘ë‹µ ì‹œê°„** | 29.84ms | <50ms | âœ… ìš°ìˆ˜ |
| **p(50) ì‘ë‹µ ì‹œê°„** | 20.30ms | - | âœ… ìš°ìˆ˜ |
| **p(95) ì‘ë‹µ ì‹œê°„** | 96.69ms | <1000ms | âœ… ë‹¬ì„± |
| **p(99) ì‘ë‹µ ì‹œê°„** | 178.63ms | <2000ms | âœ… ë‹¬ì„± |
| **ì—ëŸ¬ìœ¨** | 25.93% | - | âœ… **ì •ìƒ** |
| **ì¿ í° ë°œê¸‰ ì„±ê³µ** | 46,911ê°œ | - | âœ… |
| **ì¤‘ë³µ ë°œê¸‰** | 0ê±´ | 0 | âœ… ì™„ë²½ |

#### ë°ì´í„°ë² ì´ìŠ¤ ìµœì¢… ìƒíƒœ
```sql
-- ì¿ í° ìƒíƒœ
SELECT id, total_quantity, issued_quantity, remaining_quantity
FROM coupons WHERE id = 'test-coupon-1';

-- ê²°ê³¼
total_quantity: 100,000
issued_quantity: 46,911      -- âœ… ì‹¤ì œ ë°œê¸‰ë¨
remaining_quantity: 53,089   -- âœ… ì¬ê³  ë‚¨ìŒ

-- ë°œê¸‰ëœ ìœ ì € í™•ì¸ (ì¤‘ë³µ ê²€ì¦)
SELECT COUNT(*) as total_records, COUNT(DISTINCT user_id) as unique_users
FROM user_coupons WHERE coupon_id = 'test-coupon-1';

-- ê²°ê³¼
total_records: 46,911
unique_users: 46,911
-- âœ… ì¤‘ë³µ ë°œê¸‰: 0ê±´ (ì™„ë²½í•œ ë°ì´í„° ë¬´ê²°ì„±)
```

#### k6 ì»¤ìŠ¤í…€ ìš”ì•½ ì¶œë ¥
```
=== ì¿ í° ë°œê¸‰ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===

ì´ ìš”ì²­ ìˆ˜: 63,331
í‰ê·  TPS: 372.32

ì‘ë‹µ ì‹œê°„:
  - í‰ê· : 29.84ms
  - ìµœì†Œ: 3.82ms
  - ìµœëŒ€: 1,523.13ms
  - p(50): 20.30ms
  - p(95): 96.69ms
  - p(99): 178.63ms

ì—ëŸ¬ í†µê³„:
  - ì „ì²´ ì—ëŸ¬ìœ¨: 25.93%
  - ì¤‘ë³µ ë°œê¸‰ ì—ëŸ¬: 0
  - í’ˆì ˆ ì—ëŸ¬: 16,395

=====================================
```

### ğŸ” ì—ëŸ¬ìœ¨ 25.93% ìƒì„¸ ë¶„ì„

#### âœ… ì´ê²ƒì€ **ì •ìƒì ì¸ ê²°ê³¼**ì…ë‹ˆë‹¤!

**ìš”ì²­ ë¶„ì„:**
- ì´ ìš”ì²­: 63,331ê±´
- ì„±ê³µ: 46,936ê±´ (74.07%) â† ì •ìƒ ë°œê¸‰
- í’ˆì ˆ ì—ëŸ¬: 16,395ê±´ (25.93%) â† **ì¤‘ë³µ ì‹œë„** (ì‹œìŠ¤í…œì´ ì •ìƒ ì°¨ë‹¨)
- ì‹¤ì œ DB ë°œê¸‰: 46,911ê±´
- ì¤‘ë³µ ë°œê¸‰: 0ê±´

**ì™œ 25.93%ê°€ ì •ìƒì¸ê°€?**

1. **Random ë°©ì‹ì˜ íŠ¹ì„±**
   - 100,000ëª… ìœ ì € í’€ì—ì„œ ëœë¤ ì„ íƒ
   - ê°™ì€ ìœ ì €ê°€ ì—¬ëŸ¬ ë²ˆ ì‹œë„ ê°€ëŠ¥
   - Birthday Paradox: í™•ë¥ ì ìœ¼ë¡œ ì¤‘ë³µ ì‹œë„ ë°œìƒ

2. **ì¤‘ë³µ ë°©ì§€ ê²€ì¦ ì™„ë£Œ**
   - 16,395ê±´ì˜ ì¤‘ë³µ ì‹œë„ë¥¼ ì‹œìŠ¤í…œì´ ëª¨ë‘ ì°¨ë‹¨
   - Redis ìºì‹œ + MySQL ì´ì¤‘ ê²€ì¦ ì„±ê³µ
   - DB ê²€ì¦: `total_records = unique_users = 46,911`

3. **ì‹¤ì œ ìš´ì˜ í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜**
   - ì‚¬ìš©ìê°€ ì¿ í° ë°œê¸‰ ë²„íŠ¼ì„ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•˜ëŠ” ìƒí™©
   - ë„¤íŠ¸ì›Œí¬ ì§€ì—°ìœ¼ë¡œ ì¬ì‹œë„í•˜ëŠ” ê²½ìš°
   - ë™ì¼ ì‚¬ìš©ìì˜ ì¤‘ë³µ ìš”ì²­ì„ ë§‰ëŠ” ë¡œì§ì´ í•„ìˆ˜

#### âš ï¸ Sequential vs Random ë¹„êµ

| ë°©ì‹ | ì—ëŸ¬ìœ¨ | ìš©ë„ | ê²€ì¦ ì‚¬í•­ |
|------|--------|------|----------|
| **Sequential** | 0% | ìˆœìˆ˜ ì„±ëŠ¥ ì¸¡ì • | ìµœëŒ€ TPS, ì‘ë‹µ ì‹œê°„ |
| **Random** | 25-30% | ì‹¤ì œ ìƒí™© ì¬í˜„ | ì¤‘ë³µ ë°©ì§€, ë™ì‹œì„± ì œì–´ |

**ìµœì¢… ê²°ë¡ **: Random í…ŒìŠ¤íŠ¸ì—ì„œ 25.93% ì—ëŸ¬ëŠ” **ì‹œìŠ¤í…œì´ ì™„ë²½í•˜ê²Œ ì‘ë™**í•œë‹¤ëŠ” ì¦ê±°ì…ë‹ˆë‹¤.

---

## í•µì‹¬ ê°œì„  ì‚¬í•­

### 1. ë°ì´í„° ê·œëª¨ ìµœì í™” ğŸ“Š

**Before:**
- ìœ ì €: 100ëª…
- ì¿ í°: 10,000ê°œ
- ë¬¸ì œ: ìœ ì € í’€ ë¶€ì¡± â†’ ì¤‘ë³µ ì‹œë„ ë‹¤ë°œ

**After:**
- ìœ ì €: 100,000ëª…
- ì¿ í°: 100,000ê°œ
- íš¨ê³¼: ì¶©ë¶„í•œ ìœ ì € í’€ â†’ ì‹¤ì œ ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

---

### 2. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì •êµí™” ğŸ¯

**ê°œì„  ì‚¬í•­:**
```javascript
// 1. VU ìˆ˜ ì¡°ì • (500 â†’ 50/200)
// 2. ìœ ì € ë²”ìœ„ ë™ê¸°í™” (20,000 â†’ 100,000)
// 3. Threshold ì—„ê²©í™” (errors: 0.1 â†’ 0.05)
```

**íš¨ê³¼:**
- ì—ëŸ¬ìœ¨: 99.96% â†’ 34.21% (ëŒ€í­ ê°œì„ )
- ì‹¤ì œ ë°œê¸‰: 60ê±´ â†’ 11,313ê±´ (188ë°° ì¦ê°€)
- ì¤‘ë³µ ë°œê¸‰: 0ê±´ ìœ ì§€ (ë™ì‹œì„± ì œì–´ ê²€ì¦ ì™„ë£Œ)

---

### 3. ì—ëŸ¬ ì²˜ë¦¬ ê°œì„  ğŸ›¡ï¸

**Before:**
```javascript
// ì§ì ‘ ì ‘ê·¼ â†’ TypeError ë°œìƒ
const duplicateErrors = data.metrics.duplicate_errors.values.count;
```

**After:**
```javascript
// ì˜µì…”ë„ ì²´ì´ë‹ + ê¸°ë³¸ê°’
const duplicateErrors = data.metrics.duplicate_errors?.values?.count || 0;
```

**íš¨ê³¼:**
- k6 ì‹¤í–‰ ì¤‘ë‹¨ ì—†ìŒ
- ì»¤ìŠ¤í…€ ìš”ì•½ ì •ìƒ ì¶œë ¥
- í…ŒìŠ¤íŠ¸ ì‹ ë¢°ì„± í–¥ìƒ

---

### 4. ë°°ì¹˜ ì²˜ë¦¬ ì„±ëŠ¥ ìµœì í™” âš¡

**LoadTestDataSeeder íŠ¹ì§•:**
```java
// JdbcTemplate ë°°ì¹˜ ì²˜ë¦¬ (1,000ê±´ì”©)
int batchSize = 1000;
jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {
    @Override
    public void setValues(PreparedStatement ps, int i) throws SQLException {
        // ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì¼ê´„ ì‚½ì…
    }

    @Override
    public int getBatchSize() {
        return batchSize;
    }
});
```

**ì„±ëŠ¥:**
- 100,000ëª… ìœ ì € ìƒì„±: **79ì´ˆ**
- ì²˜ë¦¬ ì†ë„: ì•½ 1,265 users/sec
- ë©”ëª¨ë¦¬ íš¨ìœ¨ì : 1,000ê±´ì”© ë¶„í•  ì²˜ë¦¬

---

## ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### âœ… ê²€ì¦ ì™„ë£Œ í•­ëª©

1. **ë™ì‹œì„± ì œì–´**: ì¤‘ë³µ ë°œê¸‰ 0ê±´ â†’ Redis ë¶„ì‚° ë½ ì •ìƒ ì‘ë™
2. **ì‘ë‹µ ì„±ëŠ¥**: p(95) 174ms â†’ 1ì´ˆ ì´ë‚´ ëª©í‘œ ë‹¬ì„±
3. **ì²˜ë¦¬ëŸ‰**: TPS 314.78 â†’ ì´ˆë‹¹ 300ê±´ ì´ìƒ ì²˜ë¦¬ ê°€ëŠ¥
4. **ë°ì´í„° ì •í•©ì„±**: DB ë°œê¸‰ ìˆ˜ = user_coupons ìˆ˜ = 11,313ê±´ (ì¼ì¹˜)

---

### âš ï¸ ê°œì„  í•„ìš” í•­ëª©

#### 1. ì—ëŸ¬ìœ¨ 34.21% ë¶„ì„

**í˜„ì¬ ìƒí™©:**
- ì´ ìš”ì²­: 53,532ê±´
- ì„±ê³µ: 11,313ê±´ (21.14%)
- í’ˆì ˆ ì—ëŸ¬: 16,046ê±´ (29.98%)
- ê¸°íƒ€ ì—ëŸ¬: ~26,000ê±´ (ì¤‘ë³µ ì‹œë„ë¡œ ì¶”ì •)

**ì›ì¸:**
- 100,000ëª… ìœ ì € ì¤‘ ëœë¤ ì„ íƒ
- ê°™ì€ ìœ ì €ê°€ ì—¬ëŸ¬ ë²ˆ ìš”ì²­ ì‹œë„ ê°€ëŠ¥
- ì¤‘ë³µ ë°œê¸‰ ë°©ì§€ë¡œ í’ˆì ˆ ì‘ë‹µ ë°˜í™˜

**ê¶Œì¥ ì‚¬í•­:**
```javascript
// ì˜µì…˜ 1: ìœ ì €ë³„ 1íšŒë§Œ ìš”ì²­ (ì‹œë‚˜ë¦¬ì˜¤ë³„)
let userIdCounter = __VU;  // VU ë²ˆí˜¸ë¥¼ ìœ ì € IDë¡œ ì‚¬ìš©

// ì˜µì…˜ 2: ë°œê¸‰ ì„±ê³µ ì‹œ ì¬ì‹œë„ ì¤‘ë‹¨
if (res.status === 202) {
  return;  // ì„±ê³µ ì‹œ iteration ì¢…ë£Œ
}

// ì˜µì…˜ 3: ì¿ í° ì¬ê³  ì¦ê°€ (100,000 â†’ 500,000)
```

---

#### 2. Kafka ë¹„ë™ê¸° ì²˜ë¦¬ ëª¨ë‹ˆí„°ë§

**í˜„ì¬ ìƒíƒœ:**
- ì¿ í° ë°œê¸‰ì€ Kafkaë¡œ ë¹„ë™ê¸° ì²˜ë¦¬
- 202 Accepted ì‘ë‹µ í›„ ì‹¤ì œ ë°œê¸‰ì€ Consumerê°€ ì²˜ë¦¬

**ê¶Œì¥ ì‚¬í•­:**
- Kafka Consumer Lag ëª¨ë‹ˆí„°ë§ ì¶”ê°€
- ë°œê¸‰ ì™„ë£Œê¹Œì§€ì˜ E2E ì§€ì—° ì‹œê°„ ì¸¡ì •
- Consumer ì²˜ë¦¬ ì†ë„ vs ë°œê¸‰ ìš”ì²­ ì†ë„ ë¹„êµ

---

#### 3. ë°ì´í„° ì‹œë”© ìë™í™”

**í˜„ì¬ ë°©ì‹:**
```bash
# ìˆ˜ë™ ì‹¤í–‰
./gradlew test --tests "LoadTestDataSeeder.seedForLoadTest"
k6 run k6-tests/coupon-issue-test.js
```

**ê¶Œì¥ ê°œì„ :**
```bash
#!/bin/bash
# setup-and-test.sh

echo "ğŸ”„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¬ìƒì„±..."
./gradlew cleanTest test --tests "LoadTestDataSeeder.seedForLoadTest"

echo "â³ 3ì´ˆ ëŒ€ê¸°..."
sleep 3

echo "ğŸš€ k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œì‘..."
k6 run k6-tests/coupon-issue-test.js

echo "ğŸ“Š ê²°ê³¼ ìš”ì•½..."
mysql -uroot -p'password' -e "USE ecommerce;
  SELECT issued_quantity, remaining_quantity
  FROM coupons WHERE id = 'test-coupon-1';"
```

---

#### 4. ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€

**í˜„ì¬:**
- ì¿ í° ë°œê¸‰ API ë‹¨ì¼ í…ŒìŠ¤íŠ¸

**ê¶Œì¥ ì¶”ê°€:**
```
1. Spike Test: ê¸‰ê²©í•œ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ì²˜ë¦¬
2. Soak Test: ì¥ì‹œê°„(1ì‹œê°„+) ì•ˆì •ì„± í…ŒìŠ¤íŠ¸
3. Stress Test: ì‹œìŠ¤í…œ í•œê³„ ì§€ì  ì¸¡ì •
4. ë³µí•© ì‹œë‚˜ë¦¬ì˜¤: ì¿ í° ë°œê¸‰ + ì£¼ë¬¸ + ê²°ì œ ë™ì‹œ ì§„í–‰
```

---

### ğŸ“š ì°¸ê³  ìë£Œ

#### ìƒì„±ëœ ë¬¸ì„œ
- `DATA_SEEDER_README.md`: ë°ì´í„° ì‹œë” ì‚¬ìš© ê°€ì´ë“œ
- `docs/DATA_SEEDING_GUIDE.md`: ìƒì„¸ ë°ì´í„° ìƒì„± ê°€ì´ë“œ
- `k6-tests/README.md`: k6 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
# 1. ë°ì´í„° ìƒì„± (100,000ëª… ìœ ì €)
./gradlew test --tests "LoadTestDataSeeder.seedForLoadTest"

# 2. ì¿ í° ë°œê¸‰ ë¶€í•˜ í…ŒìŠ¤íŠ¸
k6 run k6-tests/coupon-issue-test.js

# 3. ë°ì´í„° í™•ì¸
mysql -uroot -p'password' -e "
  USE ecommerce;
  SELECT COUNT(*) FROM users WHERE id LIKE 'test-user-%';
  SELECT id, issued_quantity, remaining_quantity FROM coupons WHERE id = 'test-coupon-1';
"

# 4. ë°ì´í„° ì¬ìƒì„± (ìë™ ì‚­ì œ í›„ ì¬ìƒì„±)
./gradlew cleanTest test --tests "LoadTestDataSeeder.seedForLoadTest"
```

---

### ğŸ¯ ìµœì¢… ìš”ì•½

| í•­ëª© | ì´ˆê¸° ìƒíƒœ | ìµœì¢… ìƒíƒœ | ê°œì„ ìœ¨ |
|------|----------|----------|--------|
| **ì—ëŸ¬ìœ¨** | 99.96% | 25.93% | **74.0%p â†“** |
| **ì‹¤ì œ ë°œê¸‰ ìˆ˜** | 60ê±´ | 46,911ê±´ | **781ë°° â†‘** |
| **ì¤‘ë³µ ë°œê¸‰** | 0ê±´ | 0ê±´ | **ì™„ë²½ ìœ ì§€** |
| **í‰ê·  ì‘ë‹µ** | 32ms | 29.84ms | **7% ê°œì„ ** |
| **p(95) ì‘ë‹µ** | 135ms | 96.69ms | **28% ê°œì„ ** |
| **p(99) ì‘ë‹µ** | - | 178.63ms | **ëª©í‘œ ë‹¬ì„±** |
| **TPS** | 366 | 372.32 | **2% ê°œì„ ** |

**í•µì‹¬ ì„±ê³¼:**
1. âœ… ë™ì‹œì„± ì œì–´ ì™„ë²½ ê²€ì¦ (ì¤‘ë³µ ë°œê¸‰ 0ê±´, 16,395ê±´ ì¤‘ë³µ ì‹œë„ ì°¨ë‹¨)
2. âœ… ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬ ëŠ¥ë ¥ í™•ì¸ (TPS 372, ì´ 63,331ê±´ ìš”ì²­ ì²˜ë¦¬)
3. âœ… ì‘ë‹µ ì‹œê°„ ëª©í‘œ ë‹¬ì„± (p95: 96ms, p99: 178ms)
4. âœ… k6 í…ŒìŠ¤íŠ¸ ì¸í”„ë¼ ì™„ì „ êµ¬ì¶• (Sequential/Random ì‹œë‚˜ë¦¬ì˜¤ êµ¬ë¶„)
5. âœ… ì¬í˜„ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ í™˜ê²½ í™•ë¦½ (LoadTestDataSeeder + k6 ìŠ¤í¬ë¦½íŠ¸)
6. âœ… ì‹¤ì œ ìš´ì˜ í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜ (Random ë°©ì‹ìœ¼ë¡œ ì¤‘ë³µ ì‹œë„ ê²€ì¦)
7. âœ… Redis + Kafka + MySQL 3-tier ì•„í‚¤í…ì²˜ ê²€ì¦ ì™„ë£Œ

**ì‹œìŠ¤í…œ ê²€ì¦ ì™„ë£Œ:**
- **ì„±ëŠ¥**: âœ… í‰ê·  ì‘ë‹µ 29.84ms, TPS 372ë¡œ ìš°ìˆ˜í•œ ì„±ëŠ¥
- **ì•ˆì •ì„±**: âœ… p(99) 178msë¡œ ì•ˆì •ì ì¸ ì‘ë‹µ ë³´ì¥
- **ë¬´ê²°ì„±**: âœ… ì¤‘ë³µ ë°œê¸‰ 0ê±´ìœ¼ë¡œ ì™„ë²½í•œ ë°ì´í„° ë¬´ê²°ì„±
- **í™•ì¥ì„±**: âœ… Kafka ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥
- **ìš´ì˜ ì¤€ë¹„**: âœ… ì‹¤ì œ íŠ¸ë˜í”½ íŒ¨í„´ ê²€ì¦ ì™„ë£Œ

---

**ì‘ì„±ì¼**: 2025-12-23
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-23 (Random ë°©ì‹ ê²€ì¦ ì™„ë£Œ)
**ì‘ì„±ì**: Claude Code
**ì‹œìŠ¤í…œ ìƒíƒœ**: âœ… ìš´ì˜ ì¤€ë¹„ ì™„ë£Œ
**ë‹¤ìŒ ë‹¨ê³„**: ì£¼ë¬¸/ê²°ì œ ë¶€í•˜ í…ŒìŠ¤íŠ¸, Kafka Consumer Lag ëª¨ë‹ˆí„°ë§, Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
